# 调休期间工作对接 Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** 在运营部排班系统中新增调休对接说明卡片，并在“休息”单元格内联显示对接人。

**Architecture:** 在 `排班表系统.html` 中新增对接映射与辅助函数，顶部插入规则卡片，排班单元格渲染时读取员工姓名并输出对接提示；不改变既有排班算法与存储结构。

**Tech Stack:** HTML5 / CSS3 / JavaScript(ES6)，现有 CDN 依赖（Font Awesome、SheetJS、html2canvas）。

---

### Task 1: 新增对接规则映射与辅助函数

**Files:**
- Modify: `排班表系统.html`（`<script>` 内，员工名单附近，约 1008 行）

**Step 1: 写一个失败的断言（手动）**

操作：打开 `排班表系统.html`，控制台执行：
```js
console.assert(getHandoverText('王涛') === '对接：王郡江', '调休对接文案应匹配');
```
预期：抛出 `ReferenceError: getHandoverText is not defined`。

**Step 2: 写最小实现（映射 + 辅助函数）**

在员工数组下方新增：
```js
const handoverMap = {
    '王涛': '王郡江',
    '王清月': '杨有淇',
    '袁丽妮': '张玉莲'
};

function getHandoverText(employeeName) {
    const partner = handoverMap[employeeName];
    return partner ? `对接：${partner}` : '对接：无固定安排';
}

function getEmployeeNameByCell(cell) {
    const row = cell?.closest('tr');
    const nameCell = row ? row.querySelector('.employee-name') : null;
    return nameCell ? nameCell.textContent.trim() : '';
}

function renderHandoverRules() {
    const list = document.getElementById('handoverRuleList');
    if (!list) {
        return;
    }
    const items = Object.entries(handoverMap)
        .map(([restEmployee, partner]) => (
            `<div class="handover-item"><span>${restEmployee} 休息</span><span>→</span><span>${partner} 对接</span></div>`
        ))
        .join('');
    list.innerHTML = items;
}
```

**Step 3: 重新执行断言（手动）**

控制台再次执行：
```js
console.assert(getHandoverText('王涛') === '对接：王郡江', '调休对接文案应匹配');
```
预期：无错误输出。

**Step 4: 提交**

```bash
git add 排班表系统.html
git commit -m "新增调休对接规则映射与辅助函数"
```

---

### Task 2: 顶部规则卡片与样式

**Files:**
- Modify: `排班表系统.html`（`<style>` 与 `<body>`，约 150-900 行）

**Step 1: 添加样式**

在样式区新增：
```css
.handover-area {
    padding: 1rem 1.25rem;
    background: var(--light-bg);
    border-bottom: 1px solid var(--border-color);
}

.handover-card {
    background: var(--card-bg);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 1rem 1.25rem;
    box-shadow: var(--shadow-sm);
}

.handover-title {
    font-weight: 700;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
}

.handover-list {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.5rem 1rem;
    margin-bottom: 0.5rem;
}

.handover-item {
    font-size: 0.8125rem;
    color: var(--text-secondary);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.35rem;
    background: var(--bg-warm);
    border-radius: var(--radius-sm);
    padding: 0.4rem 0.6rem;
}

.handover-note {
    font-size: 0.75rem;
    color: var(--text-tertiary);
    text-align: center;
}
```

**Step 2: 插入规则卡片结构**

在 `.header` 之后、`.drag-area` 之前插入：
```html
<div class="handover-area">
    <div class="handover-card">
        <div class="handover-title">
            <i class="fas fa-handshake"></i>
            调休期间工作对接
        </div>
        <div class="handover-list" id="handoverRuleList"></div>
        <div class="handover-note">如遇特殊情况，将提前调整对接安排，非固定不变。</div>
    </div>
</div>
```

**Step 3: 启用渲染**

在 `DOMContentLoaded` 中新增调用：
```js
renderHandoverRules();
```

**Step 4: 手动检查**

刷新页面，确认顶部卡片出现且三条规则完整。

**Step 5: 提交**

```bash
git add 排班表系统.html
git commit -m "新增调休对接规则卡片"
```

---

### Task 3: 休息单元格内联显示对接人

**Files:**
- Modify: `排班表系统.html`（`setScheduleStatus` 附近，约 1140 行）

**Step 1: 写一个失败的断言（手动）**

控制台执行：
```js
const cell = document.querySelector('.schedule-cell');
setScheduleStatus(cell, 'rest');
console.assert(cell.querySelector('.handover-text'), '休息应显示对接信息');
```
预期：断言失败，因为尚未渲染 `.handover-text`。

**Step 2: 修改渲染逻辑**

更新 `setScheduleStatus`：
```js
function setScheduleStatus(cell, type) {
    cell.classList.remove('work-assigned', 'rest-assigned', 'assigned', 'handover-assigned');

    if (type === 'work') {
        cell.classList.add('work-assigned', 'assigned');
        cell.innerHTML = '<i class="fas fa-briefcase"></i> 上班';
    } else if (type === 'rest') {
        const employeeName = getEmployeeNameByCell(cell);
        const handoverText = getHandoverText(employeeName);
        cell.classList.add('rest-assigned', 'assigned', 'handover-assigned');
        cell.innerHTML = `
            <div class="schedule-status"><i class="fas fa-bed"></i> 休息</div>
            <div class="handover-text">${handoverText}</div>
        `;
    } else if (type === 'clear') {
        cell.textContent = '点击或拖拽安排';
    }
    // 保持现有动画逻辑不变
}
```

并新增样式：
```css
.schedule-cell.handover-assigned {
    flex-direction: column;
    gap: 0.25rem;
}

.schedule-status {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.handover-text {
    font-size: 0.75rem;
    font-weight: 500;
    color: rgba(255, 255, 255, 0.85);
}
```

**Step 3: 重新执行断言（手动）**

控制台再次执行：
```js
const cell = document.querySelector('.schedule-cell');
setScheduleStatus(cell, 'rest');
console.assert(cell.querySelector('.handover-text'), '休息应显示对接信息');
```
预期：无错误输出。

**Step 4: 手动全量检查**

- 生成排班，确认王涛/王清月/袁丽妮休息时显示对应对接人。
- 其他员工休息显示“对接：无固定安排”。
- 上班/空白单元格不显示对接信息。

**Step 5: 提交**

```bash
git add 排班表系统.html
git commit -m "休息单元格显示调休对接信息"
```
