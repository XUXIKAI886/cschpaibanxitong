<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘ˆå°šç­–åˆ’å…¬å¸ - è¿è¥éƒ¨æ™ºèƒ½æ’ç­ç³»ç»Ÿ</title>
    <!-- Font Awesome å›¾æ ‡åº“ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+SC:wght@300;400;500;600;700;900&family=Noto+Serif+SC:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <!-- SheetJS Excelå¯¼å‡ºåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <!-- html2canvas æˆªå›¾åº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* æ—¥å¼ç®€çº¦è‰²å½©ç³»ç»Ÿ */
            --primary-color: #2D5016;
            --primary-light: #4A7C2C;
            --primary-dark: #1F3810;
            --accent-color: #E8956C;
            --accent-light: #F4B89A;
            --success-color: #4A7C2C;
            --warning-color: #E8956C;
            --danger-color: #C84B31;
            --info-color: #5B8A72;
            --bg-cream: #FAF8F3;
            --bg-warm: #F5F1E8;
            --light-bg: #F5F1E8;
            --card-bg: #FFFFFF;
            --text-primary: #2C2C2C;
            --text-secondary: #6B6B6B;
            --text-tertiary: #9B9B9B;
            --border-color: #E8E4DC;
            --border-subtle: #E8E4DC;
            --shadow-soft: 0 2px 8px rgba(45, 80, 22, 0.04);
            --shadow-sm: 0 2px 8px rgba(45, 80, 22, 0.04);
            --shadow-md: 0 4px 16px rgba(45, 80, 22, 0.08);
            --shadow-medium: 0 4px 16px rgba(45, 80, 22, 0.08);
            --shadow-lg: 0 8px 32px rgba(45, 80, 22, 0.12);
            --shadow-strong: 0 8px 32px rgba(45, 80, 22, 0.12);
            --shadow-xl: 0 12px 48px rgba(45, 80, 22, 0.16);
            --radius-sm: 0.25rem;
            --radius-md: 0.5rem;
            --radius-lg: 1rem;
            --radius-xl: 1.5rem;
        }

        body {
            font-family: 'Noto Sans SC', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-cream) 0%, var(--bg-warm) 100%);
            min-height: 100vh;
            padding: 0.75rem;
            color: var(--text-primary);
            line-height: 1.75;
            letter-spacing: 0.01em;
            position: relative;
        }

        /* èƒŒæ™¯çº¹ç† */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(232, 149, 108, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(45, 80, 22, 0.02) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: var(--card-bg);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-strong);
            overflow: hidden;
            position: relative;
            z-index: 1;
        }

        .home-button {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            border: none;
            border-radius: var(--radius-md);
            padding: 0.75rem 1.25rem;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-soft);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            z-index: 1000;
            letter-spacing: 0.02em;
        }

        .home-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .home-button:active {
            transform: translateY(0);
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            padding: 2rem 1.25rem 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        /* å¤´éƒ¨è£…é¥°çº¹ç† */
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image:
                linear-gradient(45deg, rgba(255, 255, 255, 0.03) 25%, transparent 25%),
                linear-gradient(-45deg, rgba(255, 255, 255, 0.03) 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, rgba(255, 255, 255, 0.03) 75%),
                linear-gradient(-45deg, transparent 75%, rgba(255, 255, 255, 0.03) 75%);
            background-size: 60px 60px;
            background-position: 0 0, 0 30px, 30px -30px, -30px 0px;
            opacity: 0.5;
            pointer-events: none;
        }

        .header h1 {
            font-family: 'Noto Serif SC', serif;
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 0.5rem;
            letter-spacing: 0.02em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            position: relative;
            z-index: 1;
        }

        .header h1 i {
            font-size: 1.75rem;
            opacity: 0.9;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.92;
            font-weight: 400;
            letter-spacing: 0.03em;
            position: relative;
            z-index: 1;
            margin: 0;
        }

        .drag-area {
            padding: 1.25rem;
            background: var(--light-bg);
            border-bottom: 1px solid var(--border-color);
        }

        .drag-title {
            text-align: center;
            font-family: 'Noto Serif SC', serif;
            font-size: 1.125rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-weight: 700;
            letter-spacing: 0.02em;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .drag-title i {
            color: var(--accent-color);
        }

        .drag-items {
            display: flex;
            justify-content: center;
            gap: 1.25rem;
            flex-wrap: wrap;
        }

        .drag-item {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius-md);
            cursor: grab;
            font-weight: 600;
            font-size: 0.875rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
            user-select: none;
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            gap: 0.375rem;
            border: 2px solid transparent;
        }

        .drag-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .drag-item:hover::before {
            left: 100%;
        }

        .drag-item.work {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            border-color: var(--success-color);
        }

        .drag-item.rest {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            color: white;
            border-color: var(--warning-color);
        }

        .drag-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-lg);
        }

        .drag-item:active {
            cursor: grabbing;
            transform: scale(0.95);
        }

        .schedule-area {
            padding: 1.25rem;
        }

        .schedule-table {
            width: 100%;
            border-collapse: collapse;
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }

        .schedule-table th {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            padding: 0.875rem 0.5rem;
            text-align: center;
            font-weight: 700;
            font-size: 0.875rem;
            letter-spacing: 0.02em;
            position: relative;
        }

        .schedule-table th:first-child {
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--text-secondary) 100%);
        }

        .schedule-table td {
            border: 1px solid var(--border-color);
            padding: 0.75rem 0.5rem;
            text-align: center;
            min-height: 3rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            background: var(--card-bg);
        }

        .schedule-table td:hover {
            background: var(--light-bg);
        }

        .employee-name {
            background: linear-gradient(135deg, var(--light-bg), #f1f5f9);
            font-weight: 600;
            color: var(--text-primary);
            border-right: 3px solid var(--primary-color) !important;
            position: sticky;
            left: 0;
            z-index: 10;
        }

        .schedule-cell {
            cursor: pointer;
            min-height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.875rem;
            border-radius: var(--radius-sm);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .schedule-cell::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: transparent;
            transition: background 0.3s ease;
            pointer-events: none;
        }

        .schedule-cell:hover {
            background-color: var(--light-bg);
            transform: scale(1.02);
            box-shadow: var(--shadow-sm);
        }

        .schedule-cell.drag-over {
            background-color: #dbeafe;
            border: 2px dashed var(--info-color);
            transform: scale(1.05);
            box-shadow: var(--shadow-md);
        }

        .schedule-cell.work-assigned {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .schedule-cell.work-assigned::before {
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
        }

        .schedule-cell.rest-assigned {
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .schedule-cell.rest-assigned::before {
            background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.1) 50%, transparent 70%);
        }

        .schedule-cell.assigned {
            position: relative;
            cursor: pointer;
        }

        .schedule-cell.assigned:hover::after {
            content: 'åŒå‡»åˆ é™¤ | å³é”®èœå•';
            position: absolute;
            bottom: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            white-space: nowrap;
            z-index: 1000;
        }

        .context-menu {
            position: fixed;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            min-width: 140px;
            display: none;
            overflow: hidden;
        }

        .context-menu-item {
            padding: 0.75rem 1rem;
            cursor: pointer;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .context-menu-item:last-child {
            border-bottom: none;
        }

        .context-menu-item:hover {
            background-color: var(--light-bg);
            transform: translateX(2px);
        }

        .context-menu-item.delete {
            color: var(--danger-color);
        }

        .context-menu-item.work {
            color: var(--success-color);
        }

        .context-menu-item.rest {
            color: var(--warning-color);
        }

        .context-menu-item i {
            width: 16px;
            text-align: center;
        }

        .auto-schedule-area {
            padding: 1.25rem;
            background: var(--light-bg);
            border-top: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
        }

        .auto-schedule-title {
            text-align: center;
            font-size: 1.125rem;
            color: var(--text-primary);
            margin-bottom: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .auto-schedule-title i {
            color: var(--primary-color);
        }

        .schedule-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .day-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .day-checkbox {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.5rem 0.75rem;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            font-size: 0.8125rem;
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .day-checkbox::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(45, 80, 22, 0.1), transparent);
            transition: left 0.5s;
        }

        .day-checkbox:hover::before {
            left: 100%;
        }

        .day-checkbox:hover {
            border-color: var(--primary-color);
            background: rgba(250, 248, 243, 0.5);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .day-checkbox.selected {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        .day-checkbox input[type="checkbox"] {
            display: none;
        }

        .random-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 0.375rem;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.02em;
        }

        .random-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .random-btn:hover::before {
            left: 100%;
        }

        .random-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .random-btn:active {
            transform: translateY(0);
        }

        .random-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
            transform: none;
            box-shadow: var(--shadow-sm);
        }

        .group-info {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 0.75rem;
        }

        .group-card {
            background: var(--card-bg);
            padding: 1rem;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-md);
            min-width: 160px;
            border: 1px solid var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .group-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
        }

        .group-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .group-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            text-align: center;
            font-size: 0.9375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.375rem;
        }

        .group-members {
            font-size: 0.8125rem;
            color: var(--text-secondary);
            text-align: center;
            line-height: 1.4;
        }

        /* åº•éƒ¨æ“ä½œåŒºåŸŸæ ·å¼ */
        .bottom-actions {
            padding: 1.25rem;
            background: var(--light-bg);
            border-top: 1px solid var(--border-color);
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
            min-width: 140px;
            justify-content: center;
        }

        .action-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .action-btn:hover::before {
            left: 100%;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .action-btn:active {
            transform: translateY(0);
        }

        .clear-btn {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: white;
        }

        .export-btn {
            background: linear-gradient(135deg, var(--info-color), #2563eb);
            color: white;
        }

        .save-btn {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
        }

        .action-btn i {
            font-size: 1.125rem;
        }



        @media (max-width: 768px) {
            body {
                padding: 0.5rem;
            }

            .container {
                margin: 0;
                border-radius: var(--radius-md);
            }

            .header {
                padding: 1rem;
            }

            .header h1 {
                font-size: 1.75rem;
            }

            .header p {
                font-size: 0.875rem;
            }

            .drag-area {
                padding: 1rem;
            }

            .drag-items {
                gap: 0.75rem;
            }

            .drag-item {
                padding: 0.625rem 1.25rem;
                font-size: 0.8125rem;
            }

            .auto-schedule-area {
                padding: 1rem;
            }

            .schedule-controls {
                flex-direction: column;
                gap: 0.75rem;
            }

            .day-selector {
                justify-content: center;
                gap: 0.375rem;
            }

            .day-checkbox {
                padding: 0.375rem 0.625rem;
                font-size: 0.75rem;
            }

            .group-info {
                flex-direction: column;
                gap: 0.75rem;
            }

            .group-card {
                min-width: auto;
                padding: 0.75rem;
            }

            .schedule-area {
                padding: 1rem;
                overflow-x: auto;
            }
            
            .schedule-table {
                min-width: 600px;
            }

            .schedule-table th,
            .schedule-table td {
                padding: 0.5rem 0.25rem;
                font-size: 0.75rem;
            }

            .schedule-cell {
                min-height: 2.5rem;
                font-size: 0.75rem;
            }

            .bottom-actions {
                padding: 1rem;
            }

            .action-buttons {
                gap: 0.75rem;
            }

            .action-btn {
                padding: 0.625rem 1.25rem;
                font-size: 0.8125rem;
                min-width: 120px;
            }

            .cleaning-area {
                padding: 1rem;
            }

            .cleaning-cards {
                gap: 0.75rem;
            }

            .cleaning-card {
                min-width: auto;
                padding: 0.75rem;
                flex: 1;
                max-width: 140px;
            }

            .cleaning-employee {
                font-size: 0.875rem;
            }

            .cleaning-task {
                font-size: 0.75rem;
                padding: 0.375rem 0.5rem;
            }

            .task-name {
                font-size: 0.75rem;
            }

            .task-description {
                font-size: 0.6875rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- è¿”å›é¦–é¡µæŒ‰é’® -->
        <a href="index.html" class="home-button">
            <i class="fas fa-home"></i>
            è¿”å›é¦–é¡µ
        </a>

        <!-- å¤´éƒ¨æ ‡é¢˜ -->
        <div class="header">
            <h1>
                <i class="fas fa-calendar-alt"></i>
                å‘ˆå°šç­–åˆ’å…¬å¸ - è¿è¥éƒ¨æ™ºèƒ½æ’ç­ç³»ç»Ÿ
            </h1>
            <p>è¿è¥éƒ¨å¯æ‹–æ‹½æ’ç­è¡¨ç³»ç»Ÿï¼ˆ6äººï¼‰</p>
        </div>

        <!-- æ‹–æ‹½æ ‡ç­¾åŒºåŸŸ -->
        <div class="drag-area">
            <div class="drag-title">
                <i class="fas fa-hand-paper"></i>
                æ‹–æ‹½ä¸‹æ–¹æ ‡ç­¾åˆ°æ’ç­è¡¨ä¸­å®‰æ’å·¥ä½œ
            </div>
            <div class="drag-items">
                <div class="drag-item work" draggable="true" data-type="work">
                    <i class="fas fa-briefcase"></i>
                    ä¸Šç­
                </div>
                <div class="drag-item rest" draggable="true" data-type="rest">
                    <i class="fas fa-bed"></i>
                    ä¼‘æ¯
                </div>
            </div>
        </div>

        <!-- è‡ªåŠ¨æ’ç­åŒºåŸŸ -->
        <div class="auto-schedule-area">
            <div class="auto-schedule-title">
                <i class="fas fa-magic"></i>
                æ™ºèƒ½éšæœºæ’ç­
            </div>

            <div class="schedule-controls">
                <div class="day-selector">
                    <label class="day-checkbox">
                        <input type="checkbox" value="0" data-day="æ˜ŸæœŸä¸€">
                        <span>æ˜ŸæœŸä¸€</span>
                    </label>
                    <label class="day-checkbox">
                        <input type="checkbox" value="1" data-day="æ˜ŸæœŸäºŒ">
                        <span>æ˜ŸæœŸäºŒ</span>
                    </label>
                    <label class="day-checkbox">
                        <input type="checkbox" value="2" data-day="æ˜ŸæœŸä¸‰">
                        <span>æ˜ŸæœŸä¸‰</span>
                    </label>
                    <label class="day-checkbox">
                        <input type="checkbox" value="3" data-day="æ˜ŸæœŸå››">
                        <span>æ˜ŸæœŸå››</span>
                    </label>
                    <label class="day-checkbox">
                        <input type="checkbox" value="4" data-day="æ˜ŸæœŸäº”">
                        <span>æ˜ŸæœŸäº”</span>
                    </label>
                    <label class="day-checkbox selected">
                        <input type="checkbox" value="5" data-day="æ˜ŸæœŸå…­" checked>
                        <span>æ˜ŸæœŸå…­</span>
                    </label>
                    <label class="day-checkbox selected">
                        <input type="checkbox" value="6" data-day="æ˜ŸæœŸå¤©" checked>
                        <span>æ˜ŸæœŸå¤©</span>
                    </label>
                </div>

                <button class="random-btn" onclick="generateRandomSchedule()">
                    <i class="fas fa-dice"></i>
                    ç”Ÿæˆéšæœºæ’ç­
                </button>
            </div>

            <div class="group-info">
                <div class="group-card">
                    <div class="group-title">
                        <i class="fas fa-users"></i>
                        è¿è¥ç»„
                    </div>
                    <div class="group-members">ç‹éƒ¡æ±Ÿã€æ¨æœ‰æ·‡ã€å¼ ç‰è²ã€ç‹æ¶›ã€ç‹æ¸…æœˆã€è¢ä¸½å¦®</div>
                </div>
                <div class="group-card">
                    <div class="group-title">
                        <i class="fas fa-clipboard-list"></i>
                        æ’ç­è§„åˆ™
                    </div>
                    <div class="group-members">
                        æ˜ŸæœŸå¤©ï¼šéšæœº2äººä¸Šç­<br>
                        2å¤©æ’ç­ï¼šæ¯äººå·¥ä½œ1å¤©ä¼‘æ¯1å¤©<br>
                        äº’è¡¥åŸåˆ™ï¼šæ˜ŸæœŸå¤©ä¸Šç­â†’å¦ä¸€å¤©ä¼‘æ¯<br>
                        å…¶ä»–ï¼šéšæœºå®‰æ’
                    </div>
                </div>
            </div>
        </div>

        <!-- æ’ç­è¡¨åŒºåŸŸ -->
        <div class="schedule-area">
            <table class="schedule-table">
                <thead>
                    <tr>
                        <th>å‘˜å·¥å§“å</th>
                        <th>æ˜ŸæœŸä¸€</th>
                        <th>æ˜ŸæœŸäºŒ</th>
                        <th>æ˜ŸæœŸä¸‰</th>
                        <th>æ˜ŸæœŸå››</th>
                        <th>æ˜ŸæœŸäº”</th>
                        <th>æ˜ŸæœŸå…­</th>
                        <th>æ˜ŸæœŸå¤©</th>
                    </tr>
                </thead>
                <tbody id="scheduleBody">
                    <!-- å‘˜å·¥æ’ç­è¡Œå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
        </div>



        <!-- åº•éƒ¨æ“ä½œåŒºåŸŸ -->
        <div class="bottom-actions">
            <div class="action-buttons">
                <button class="action-btn clear-btn" onclick="clearSchedule()">
                    <i class="fas fa-trash-alt"></i>
                    <span>æ¸…ç©ºæ’ç­è¡¨</span>
                </button>
                <button class="action-btn export-btn" onclick="exportToExcel()">
                    <i class="fas fa-file-excel"></i>
                    <span>å¯¼å‡ºExcel</span>
                </button>
                <button class="action-btn save-btn" onclick="saveSchedule()">
                    <i class="fas fa-save"></i>
                    <span>ä¿å­˜æ’ç­</span>
                </button>
                <button class="action-btn" style="background: linear-gradient(135deg, #06b6d4, #3b82f6); color: white;" onclick="copyTableScreenshot()">
                    <i class="fas fa-camera"></i>
                    <span>å¤åˆ¶è¡¨æ ¼æˆªå›¾</span>
                </button>
            </div>
        </div>
    </div>

    <!-- å³é”®èœå• -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item work" data-action="work">
            <i class="fas fa-briefcase"></i>
            è®¾ä¸ºä¸Šç­
        </div>
        <div class="context-menu-item rest" data-action="rest">
            <i class="fas fa-bed"></i>
            è®¾ä¸ºä¼‘æ¯
        </div>
        <div class="context-menu-item delete" data-action="delete">
            <i class="fas fa-trash-alt"></i>
            æ¸…ç©º
        </div>
    </div>

    <script>
        // å‘˜å·¥åå•å’Œåˆ†ç»„
        const employees = ['ç‹éƒ¡æ±Ÿ', 'æ¨æœ‰æ·‡', 'å¼ ç‰è²', 'ç‹æ¶›', 'ç‹æ¸…æœˆ', 'è¢ä¸½å¦®'];
        const operationGroup = ['ç‹éƒ¡æ±Ÿ', 'æ¨æœ‰æ·‡', 'å¼ ç‰è²', 'ç‹æ¶›', 'ç‹æ¸…æœˆ', 'è¢ä¸½å¦®']; // è¿è¥ç»„6äººï¼ˆå½­æ¶¦æ¢…å·²ç¦»èŒï¼‰
        const dayNames = ['æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­', 'æ˜ŸæœŸå¤©'];


        
        // åˆå§‹åŒ–æ’ç­è¡¨
        function initScheduleTable() {
            const tbody = document.getElementById('scheduleBody');
            
            employees.forEach(employee => {
                const row = document.createElement('tr');
                
                // å‘˜å·¥å§“ååˆ—
                const nameCell = document.createElement('td');
                nameCell.className = 'employee-name';
                nameCell.textContent = employee;
                row.appendChild(nameCell);
                
                // ä¸€å‘¨7å¤©çš„æ’ç­å•å…ƒæ ¼
                for (let day = 0; day < 7; day++) {
                    const cell = document.createElement('td');
                    const scheduleCell = document.createElement('div');
                    scheduleCell.className = 'schedule-cell';
                    scheduleCell.textContent = 'ç‚¹å‡»æˆ–æ‹–æ‹½å®‰æ’';
                    
                    // æ·»åŠ æ‹–æ‹½äº‹ä»¶ç›‘å¬å™¨
                    scheduleCell.addEventListener('dragover', handleDragOver);
                    scheduleCell.addEventListener('drop', handleDrop);
                    scheduleCell.addEventListener('dragleave', handleDragLeave);

                    // æ·»åŠ åŒå‡»åˆ é™¤åŠŸèƒ½
                    scheduleCell.addEventListener('dblclick', handleDoubleClick);

                    // æ·»åŠ å³é”®èœå•åŠŸèƒ½
                    scheduleCell.addEventListener('contextmenu', handleRightClick);
                    
                    cell.appendChild(scheduleCell);
                    row.appendChild(cell);
                }
                
                tbody.appendChild(row);
            });
        }
        
        // åˆå§‹åŒ–æ‹–æ‹½åŠŸèƒ½
        function initDragAndDrop() {
            const dragItems = document.querySelectorAll('.drag-item');

            dragItems.forEach(item => {
                item.addEventListener('dragstart', handleDragStart);
            });
        }

        // åˆå§‹åŒ–å¤©æ•°é€‰æ‹©å™¨
        function initDaySelector() {
            const dayCheckboxes = document.querySelectorAll('.day-checkbox');

            dayCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('click', function() {
                    const input = this.querySelector('input[type="checkbox"]');
                    input.checked = !input.checked;

                    if (input.checked) {
                        this.classList.add('selected');
                    } else {
                        this.classList.remove('selected');
                    }

                    // æ›´æ–°æŒ‰é’®çŠ¶æ€
                    updateRandomButtonState();
                });
            });
        }

        // æ›´æ–°éšæœºæ’ç­æŒ‰é’®çŠ¶æ€
        function updateRandomButtonState() {
            const selectedDays = document.querySelectorAll('.day-checkbox input:checked');
            const randomBtn = document.querySelector('.random-btn');

            if (selectedDays.length === 0) {
                randomBtn.disabled = true;
                randomBtn.textContent = 'è¯·å…ˆé€‰æ‹©æ’ç­å¤©æ•°';
            } else {
                randomBtn.disabled = false;
                randomBtn.textContent = `ğŸ¯ ç”Ÿæˆéšæœºæ’ç­ (${selectedDays.length}å¤©)`;
            }
        }
        
        // æ‹–æ‹½å¼€å§‹äº‹ä»¶
        function handleDragStart(e) {
            const type = e.target.getAttribute('data-type');
            e.dataTransfer.setData('text/plain', type);
            e.target.style.opacity = '0.5';
            
            // æ·»åŠ æ‹–æ‹½æ•ˆæœ
            setTimeout(() => {
                e.target.style.opacity = '1';
            }, 100);
        }
        
        // æ‹–æ‹½æ‚¬åœäº‹ä»¶
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }
        
        // æ‹–æ‹½ç¦»å¼€äº‹ä»¶
        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }
        
        // æ‹–æ‹½æ”¾ç½®äº‹ä»¶
        function handleDrop(e) {
            e.preventDefault();
            const type = e.dataTransfer.getData('text/plain');
            const cell = e.currentTarget;

            // ç§»é™¤æ‹–æ‹½æ‚¬åœæ•ˆæœ
            cell.classList.remove('drag-over');

            // è®¾ç½®æ’ç­çŠ¶æ€
            setScheduleStatus(cell, type);
        }

        // è®¾ç½®æ’ç­çŠ¶æ€çš„é€šç”¨å‡½æ•°
        function setScheduleStatus(cell, type) {
            // æ¸…é™¤ä¹‹å‰çš„çŠ¶æ€
            cell.classList.remove('work-assigned', 'rest-assigned', 'assigned');

            // æ ¹æ®ç±»å‹è®¾ç½®æ–°çŠ¶æ€
            if (type === 'work') {
                cell.classList.add('work-assigned', 'assigned');
                cell.innerHTML = '<i class="fas fa-briefcase"></i> ä¸Šç­';
            } else if (type === 'rest') {
                cell.classList.add('rest-assigned', 'assigned');
                cell.innerHTML = '<i class="fas fa-bed"></i> ä¼‘æ¯';
            } else if (type === 'clear') {
                cell.textContent = 'ç‚¹å‡»æˆ–æ‹–æ‹½å®‰æ’';
            }

            // æ·»åŠ æˆåŠŸåŠ¨ç”»æ•ˆæœ
            cell.style.transform = 'scale(1.1)';
            setTimeout(() => {
                cell.style.transform = 'scale(1)';
            }, 200);
        }

        // åŒå‡»åˆ é™¤åŠŸèƒ½
        function handleDoubleClick(e) {
            const cell = e.currentTarget;
            if (cell.classList.contains('assigned')) {
                setScheduleStatus(cell, 'clear');

                // æ·»åŠ åˆ é™¤åŠ¨ç”»æ•ˆæœ
                cell.style.background = '#ffebee';
                setTimeout(() => {
                    cell.style.background = '';
                }, 300);
            }
        }

        // å³é”®èœå•åŠŸèƒ½
        function handleRightClick(e) {
            e.preventDefault();
            const contextMenu = document.getElementById('contextMenu');
            const cell = e.currentTarget;

            // è®¾ç½®èœå•ä½ç½®
            contextMenu.style.left = e.pageX + 'px';
            contextMenu.style.top = e.pageY + 'px';
            contextMenu.style.display = 'block';

            // å­˜å‚¨å½“å‰å•å…ƒæ ¼å¼•ç”¨
            contextMenu.currentCell = cell;

            // ç‚¹å‡»å…¶ä»–åœ°æ–¹éšè—èœå•
            setTimeout(() => {
                document.addEventListener('click', hideContextMenu);
            }, 10);
        }

        // éšè—å³é”®èœå•
        function hideContextMenu() {
            const contextMenu = document.getElementById('contextMenu');
            contextMenu.style.display = 'none';
            document.removeEventListener('click', hideContextMenu);
        }
        
        // åˆå§‹åŒ–å³é”®èœå•äº‹ä»¶
        function initContextMenu() {
            const contextMenu = document.getElementById('contextMenu');
            const menuItems = contextMenu.querySelectorAll('.context-menu-item');

            menuItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    const action = this.getAttribute('data-action');
                    const cell = contextMenu.currentCell;

                    if (cell) {
                        if (action === 'delete') {
                            setScheduleStatus(cell, 'clear');
                        } else {
                            setScheduleStatus(cell, action);
                        }
                    }

                    hideContextMenu();
                });
            });
        }

        // éšæœºæ’ç­ç”Ÿæˆå‡½æ•°
        function generateRandomSchedule() {
            const selectedDays = document.querySelectorAll('.day-checkbox input:checked');

            if (selectedDays.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦æ’ç­çš„å¤©æ•°ï¼');
                return;
            }

            // è·å–æ‰€æœ‰æ’ç­å•å…ƒæ ¼
            const scheduleRows = document.querySelectorAll('#scheduleBody tr');
            const selectedDaysList = Array.from(selectedDays).map(input => ({
                index: parseInt(input.value),
                name: input.getAttribute('data-day')
            }));

            // æ¸…ç©ºé€‰ä¸­å¤©æ•°çš„æ‰€æœ‰æ’ç­
            selectedDaysList.forEach(day => {
                scheduleRows.forEach(row => {
                    const cell = row.children[day.index + 1];
                    if (cell) {
                        const scheduleCell = cell.querySelector('.schedule-cell');
                        setScheduleStatus(scheduleCell, 'clear');
                    }
                });
            });

            // å¦‚æœé€‰æ‹©2å¤©ï¼Œä½¿ç”¨ç‰¹æ®Šçš„äººå‘˜é…ç½®ç®—æ³•
            if (selectedDaysList.length === 2) {
                generateTwoDaySchedule(selectedDaysList, scheduleRows);
            } else {
                // å•å¤©æˆ–å¤šå¤©ï¼ˆé2å¤©ï¼‰ä½¿ç”¨åŸæœ‰é€»è¾‘
                generateRegularSchedule(selectedDaysList, scheduleRows);
            }

            // æ˜¾ç¤ºæˆåŠŸæç¤º
            showSuccessMessage();


        }

        // 2å¤©æ’ç­çš„ç‰¹æ®Šç®—æ³• - ä¸¥æ ¼äº’è¡¥æ’ç­é€»è¾‘
        function generateTwoDaySchedule(selectedDays, scheduleRows) {
            console.log('=== å¼€å§‹2å¤©äº’è¡¥æ’ç­ç®—æ³• ===');
            console.log(`é€‰æ‹©çš„å¤©æ•°: ${selectedDays.map(d => d.name).join(', ')}`);

            // æ£€æŸ¥æ˜¯å¦åŒ…å«æ˜ŸæœŸå¤©
            const sundayDay = selectedDays.find(day => day.name === 'æ˜ŸæœŸå¤©');
            const otherDay = selectedDays.find(day => day.name !== 'æ˜ŸæœŸå¤©');

            if (!sundayDay) {
                // å¦‚æœæ²¡æœ‰æ˜ŸæœŸå¤©ï¼Œä½¿ç”¨å¸¸è§„ç®—æ³•
                console.log('æ²¡æœ‰æ˜ŸæœŸå¤©ï¼Œä½¿ç”¨å¸¸è§„2å¤©æ’ç­');
                generateRegularTwoDaySchedule(selectedDays, scheduleRows);
                return;
            }

            console.log(`æ˜ŸæœŸå¤©: ${sundayDay.name}, å¦ä¸€å¤©: ${otherDay.name}`);

            // ç¬¬ä¸€æ­¥ï¼šå¤„ç†æ˜ŸæœŸå¤© - éšæœºé€‰æ‹©2äººä¸Šç­
            const shuffledEmployees = [...employees].sort(() => Math.random() - 0.5);
            const sundayWorker1 = shuffledEmployees[0];
            const sundayWorker2 = shuffledEmployees[1];

            console.log(`æ˜ŸæœŸå¤©ä¸Šç­äººå‘˜: ${sundayWorker1}, ${sundayWorker2}`);

            // ç¬¬äºŒæ­¥ï¼šç¡®å®šæ˜ŸæœŸå¤©ä¼‘æ¯çš„äººå‘˜
            const sundayRestEmployees = employees.filter(emp =>
                emp !== sundayWorker1 && emp !== sundayWorker2
            );

            console.log(`æ˜ŸæœŸå¤©ä¼‘æ¯äººå‘˜: ${sundayRestEmployees.join(', ')}`);

            // ç¬¬ä¸‰æ­¥ï¼šåº”ç”¨äº’è¡¥åŸåˆ™
            // æ˜ŸæœŸå¤©ä¸Šç­çš„äººï¼Œå¦ä¸€å¤©ä¼‘æ¯
            // æ˜ŸæœŸå¤©ä¼‘æ¯çš„äººï¼Œå¦ä¸€å¤©ä¸Šç­
            const otherDayWorkers = sundayRestEmployees;
            const otherDayRestEmployees = [sundayWorker1, sundayWorker2];

            console.log(`${otherDay.name}ä¸Šç­äººå‘˜: ${otherDayWorkers.join(', ')}`);
            console.log(`${otherDay.name}ä¼‘æ¯äººå‘˜: ${otherDayRestEmployees.join(', ')}`);

            // ç¬¬å››æ­¥ï¼šåº”ç”¨æ’ç­åˆ°ç•Œé¢
            scheduleRows.forEach(row => {
                const employeeName = row.children[0].textContent;

                // å¤„ç†æ˜ŸæœŸå¤©
                const sundayCell = row.children[sundayDay.index + 1];
                if (sundayCell) {
                    const sundayScheduleCell = sundayCell.querySelector('.schedule-cell');
                    if (employeeName === sundayWorker1 || employeeName === sundayWorker2) {
                        setScheduleStatus(sundayScheduleCell, 'work');
                    } else {
                        setScheduleStatus(sundayScheduleCell, 'rest');
                    }
                }

                // å¤„ç†å¦ä¸€å¤©
                const otherDayCell = row.children[otherDay.index + 1];
                if (otherDayCell) {
                    const otherDayScheduleCell = otherDayCell.querySelector('.schedule-cell');
                    if (otherDayWorkers.includes(employeeName)) {
                        setScheduleStatus(otherDayScheduleCell, 'work');
                    } else {
                        setScheduleStatus(otherDayScheduleCell, 'rest');
                    }
                }
            });

            // ç¬¬äº”æ­¥ï¼šéªŒè¯æ’ç­ç»“æœ
            console.log('=== æ’ç­éªŒè¯ ===');
            let isValid = true;

            employees.forEach(emp => {
                let workDays = 0;
                let restDays = 0;

                selectedDays.forEach(day => {
                    scheduleRows.forEach(row => {
                        if (row.children[0].textContent === emp) {
                            const cell = row.children[day.index + 1];
                            if (cell) {
                                const scheduleCell = cell.querySelector('.schedule-cell');
                                if (scheduleCell.classList.contains('work-assigned')) {
                                    workDays++;
                                } else if (scheduleCell.classList.contains('rest-assigned')) {
                                    restDays++;
                                }
                            }
                        }
                    });
                });

                console.log(`${emp}: å·¥ä½œ${workDays}å¤©, ä¼‘æ¯${restDays}å¤©`);

                if (workDays !== 1 || restDays !== 1) {
                    console.error(`âŒ ${emp} æ’ç­ä¸ç¬¦åˆè§„åˆ™ï¼åº”è¯¥å·¥ä½œ1å¤©ä¼‘æ¯1å¤©`);
                    isValid = false;
                }
            });

            // éªŒè¯æ˜ŸæœŸå¤©äººæ•°
            let sundayWorkCount = 0;
            scheduleRows.forEach(row => {
                const cell = row.children[sundayDay.index + 1];
                if (cell && cell.querySelector('.schedule-cell').classList.contains('work-assigned')) {
                    sundayWorkCount++;
                }
            });

            console.log(`æ˜ŸæœŸå¤©ä¸Šç­äººæ•°: ${sundayWorkCount}`);
            if (sundayWorkCount !== 2) {
                console.error(`âŒ æ˜ŸæœŸå¤©ä¸Šç­äººæ•°é”™è¯¯ï¼åº”è¯¥æ˜¯2äººï¼Œå®é™…æ˜¯${sundayWorkCount}äºº`);
                isValid = false;
            }

            if (isValid) {
                console.log('âœ… æ’ç­éªŒè¯é€šè¿‡ï¼');
            } else {
                console.error('âŒ æ’ç­éªŒè¯å¤±è´¥ï¼');
            }

            console.log('=== 2å¤©äº’è¡¥æ’ç­ç®—æ³•å®Œæˆ ===');
        }

        // å¸¸è§„2å¤©æ’ç­ç®—æ³•ï¼ˆä¸åŒ…å«æ˜ŸæœŸå¤©ï¼‰
        function generateRegularTwoDaySchedule(selectedDays, scheduleRows) {
            console.log('æ‰§è¡Œå¸¸è§„2å¤©æ’ç­ç®—æ³•');

            // ä¸ºæ¯ä¸ªäººéšæœºåˆ†é…1å¤©å·¥ä½œï¼Œ1å¤©ä¼‘æ¯
            employees.forEach(emp => {
                const workDayIndex = Math.floor(Math.random() * 2); // 0æˆ–1

                selectedDays.forEach((day, dayIdx) => {
                    scheduleRows.forEach(row => {
                        if (row.children[0].textContent === emp) {
                            const cell = row.children[day.index + 1];
                            if (cell) {
                                const scheduleCell = cell.querySelector('.schedule-cell');
                                if (dayIdx === workDayIndex) {
                                    setScheduleStatus(scheduleCell, 'work');
                                } else {
                                    setScheduleStatus(scheduleCell, 'rest');
                                }
                            }
                        }
                    });
                });
            });
        }


        // å¸¸è§„æ’ç­ç®—æ³•ï¼ˆé2å¤©ï¼‰
        function generateRegularSchedule(selectedDays, scheduleRows) {
            selectedDays.forEach(day => {
                if (day.name === 'æ˜ŸæœŸå¤©') {
                    // æ˜ŸæœŸå¤©ç‰¹æ®Šè§„åˆ™ï¼šéšæœº2äººä¸Šç­
                    const shuffledEmployees = [...employees].sort(() => Math.random() - 0.5);
                    const sundayWorker1 = shuffledEmployees[0];
                    const sundayWorker2 = shuffledEmployees[1];

                    scheduleRows.forEach(row => {
                        const employeeName = row.children[0].textContent;
                        const cell = row.children[day.index + 1];

                        if (cell) {
                            const scheduleCell = cell.querySelector('.schedule-cell');

                            if (employeeName === sundayWorker1 || employeeName === sundayWorker2) {
                                setScheduleStatus(scheduleCell, 'work');
                            } else {
                                setScheduleStatus(scheduleCell, 'rest');
                            }
                        }
                    });
                } else {
                    // å…¶ä»–å¤©æ•°ï¼šéšæœºå®‰æ’
                    const workCount = Math.floor(Math.random() * 4) + 2; // 2-5ä¸ªäººä¸Šç­
                    const shuffledEmployees = [...employees].sort(() => Math.random() - 0.5);
                    const workingEmployees = shuffledEmployees.slice(0, workCount);

                    scheduleRows.forEach(row => {
                        const employeeName = row.children[0].textContent;
                        const cell = row.children[day.index + 1];

                        if (cell) {
                            const scheduleCell = cell.querySelector('.schedule-cell');

                            if (workingEmployees.includes(employeeName)) {
                                setScheduleStatus(scheduleCell, 'work');
                            } else {
                                setScheduleStatus(scheduleCell, 'rest');
                            }
                        }
                    });
                }
            });
        }

        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
        function showSuccessMessage() {
            const randomBtn = document.querySelector('.random-btn');
            const originalText = randomBtn.innerHTML;
            randomBtn.innerHTML = '<i class="fas fa-check"></i> æ’ç­ç”Ÿæˆå®Œæˆï¼';
            randomBtn.style.background = 'linear-gradient(135deg, #28a745, #20c997)';

            setTimeout(() => {
                randomBtn.innerHTML = originalText;
                randomBtn.style.background = '';
            }, 2000);
        }

        // æ¸…ç©ºæ’ç­è¡¨
        function clearSchedule() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ’ç­å®‰æ’å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                const scheduleCells = document.querySelectorAll('.schedule-cell');
                scheduleCells.forEach(cell => {
                    setScheduleStatus(cell, 'clear');
                });



                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showActionMessage('clear-btn', '<i class="fas fa-check"></i> æ’ç­è¡¨å·²æ¸…ç©º', '#ef4444');
            }
        }

        // å¯¼å‡ºExcel
        function exportToExcel() {
            try {
                // åˆ›å»ºå·¥ä½œç°¿
                const wb = XLSX.utils.book_new();

                // è·å–æ’ç­æ•°æ®
                const scheduleData = [];
                const headerRow = ['å‘˜å·¥å§“å', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­', 'æ˜ŸæœŸå¤©'];
                scheduleData.push(headerRow);

                const scheduleRows = document.querySelectorAll('#scheduleBody tr');
                scheduleRows.forEach(row => {
                    const rowData = [];
                    const cells = row.querySelectorAll('td');

                    cells.forEach((cell, index) => {
                        if (index === 0) {
                            // å‘˜å·¥å§“å
                            rowData.push(cell.textContent);
                        } else {
                            // æ’ç­çŠ¶æ€
                            const scheduleCell = cell.querySelector('.schedule-cell');
                            if (scheduleCell.classList.contains('work-assigned')) {
                                rowData.push('ä¸Šç­');
                            } else if (scheduleCell.classList.contains('rest-assigned')) {
                                rowData.push('ä¼‘æ¯');
                            } else {
                                rowData.push('');
                            }
                        }
                    });

                    scheduleData.push(rowData);
                });

                // åˆ›å»ºå·¥ä½œè¡¨
                const ws = XLSX.utils.aoa_to_sheet(scheduleData);

                // è®¾ç½®åˆ—å®½
                ws['!cols'] = [
                    { width: 12 }, // å‘˜å·¥å§“å
                    { width: 10 }, // æ˜ŸæœŸä¸€
                    { width: 10 }, // æ˜ŸæœŸäºŒ
                    { width: 10 }, // æ˜ŸæœŸä¸‰
                    { width: 10 }, // æ˜ŸæœŸå››
                    { width: 10 }, // æ˜ŸæœŸäº”
                    { width: 10 }, // æ˜ŸæœŸå…­
                    { width: 10 }  // æ˜ŸæœŸå¤©
                ];

                // æ·»åŠ å·¥ä½œè¡¨åˆ°å·¥ä½œç°¿
                XLSX.utils.book_append_sheet(wb, ws, 'æ’ç­è¡¨');

                // ç”Ÿæˆæ–‡ä»¶å
                const now = new Date();
                const fileName = `æ’ç­è¡¨_${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2,'0')}${now.getDate().toString().padStart(2,'0')}.xlsx`;

                // å¯¼å‡ºæ–‡ä»¶
                XLSX.writeFile(wb, fileName);

                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showActionMessage('export-btn', '<i class="fas fa-check"></i> å¯¼å‡ºæˆåŠŸ', '#3b82f6');

            } catch (error) {
                console.error('å¯¼å‡ºå¤±è´¥:', error);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ˜¯å¦å·²åŠ è½½Excelå¯¼å‡ºåº“ã€‚');
            }
        }

        // ä¿å­˜æ’ç­
        function saveSchedule() {
            try {
                const scheduleData = {};
                const scheduleRows = document.querySelectorAll('#scheduleBody tr');

                scheduleRows.forEach(row => {
                    const employeeName = row.querySelector('.employee-name').textContent;
                    const weekSchedule = {};

                    const cells = row.querySelectorAll('td');
                    cells.forEach((cell, index) => {
                        if (index > 0) { // è·³è¿‡å‘˜å·¥å§“ååˆ—
                            const dayName = dayNames[index - 1];
                            const scheduleCell = cell.querySelector('.schedule-cell');

                            if (scheduleCell.classList.contains('work-assigned')) {
                                weekSchedule[dayName] = 'ä¸Šç­';
                            } else if (scheduleCell.classList.contains('rest-assigned')) {
                                weekSchedule[dayName] = 'ä¼‘æ¯';
                            } else {
                                weekSchedule[dayName] = '';
                            }
                        }
                    });

                    scheduleData[employeeName] = weekSchedule;
                });

                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                const saveKey = `schedule_${new Date().getTime()}`;
                localStorage.setItem(saveKey, JSON.stringify(scheduleData));
                localStorage.setItem('latest_schedule', saveKey);

                // æ˜¾ç¤ºæˆåŠŸæç¤º
                showActionMessage('save-btn', '<i class="fas fa-check"></i> ä¿å­˜æˆåŠŸ', '#10b981');

            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨æ˜¯å¦æ”¯æŒæœ¬åœ°å­˜å‚¨ã€‚');
            }
        }

        // æ£€æµ‹æ˜¯å¦åœ¨Tauriç¯å¢ƒä¸­è¿è¡Œ
        function isTauriEnvironment() {
            return typeof window !== 'undefined' &&
                   typeof window.__TAURI__ !== 'undefined' &&
                   typeof window.__TAURI__.core !== 'undefined';
        }

        // ä¸‹è½½å›¾ç‰‡ä½œä¸ºé™çº§æ–¹æ¡ˆ
        function downloadImage(canvas, filename) {
            const link = document.createElement('a');
            link.download = filename;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        // å¤åˆ¶è¡¨æ ¼æˆªå›¾åˆ°å‰ªåˆ‡æ¿
        async function copyTableScreenshot() {
            try {
                // è·å–æ’ç­è¡¨åŒºåŸŸå…ƒç´ 
                const scheduleArea = document.querySelector('.schedule-area');

                if (!scheduleArea) {
                    alert('æœªæ‰¾åˆ°æ’ç­è¡¨åŒºåŸŸ');
                    return;
                }

                // æ˜¾ç¤ºåŠ è½½æç¤º
                const button = event.target.closest('.action-btn');
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-spinner fa-spin"></i><span>æˆªå›¾ä¸­...</span>';
                button.disabled = true;

                // æ£€æµ‹è¿è¡Œç¯å¢ƒ
                const isTauri = isTauriEnvironment();
                console.log('ğŸ” [æˆªå›¾] ç¯å¢ƒæ£€æµ‹:', isTauri ? 'Tauriæ¡Œé¢åº”ç”¨' : 'æµè§ˆå™¨');

                // ä½¿ç”¨html2canvasæˆªå›¾
                const canvas = await html2canvas(scheduleArea, {
                    backgroundColor: '#ffffff',
                    scale: 2, // æé«˜æ¸…æ™°åº¦
                    logging: false,
                    useCORS: true
                });

                // å°†canvasè½¬æ¢ä¸ºblob
                canvas.toBlob(async (blob) => {
                    try {
                        // å°è¯•ä½¿ç”¨Clipboard APIå¤åˆ¶åˆ°å‰ªåˆ‡æ¿
                        await navigator.clipboard.write([
                            new ClipboardItem({
                                'image/png': blob
                            })
                        ]);

                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        button.innerHTML = originalText;
                        button.disabled = false;

                        // æ˜¾ç¤ºæˆåŠŸæç¤º
                        console.log('âœ… [å‰ªåˆ‡æ¿] å›¾ç‰‡å¤åˆ¶æˆåŠŸ');
                        showActionMessage('action-btn', '<i class="fas fa-check"></i> æˆªå›¾å·²å¤åˆ¶', '#06b6d4');
                    } catch (err) {
                        console.error('âš ï¸ [å‰ªåˆ‡æ¿] å¤åˆ¶å¤±è´¥ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ:', err.message);

                        // é™çº§æ–¹æ¡ˆï¼šä¸‹è½½å›¾ç‰‡
                        const filename = `æ’ç­è¡¨_${new Date().toISOString().slice(0,10)}.png`;
                        downloadImage(canvas, filename);

                        // æ¢å¤æŒ‰é’®çŠ¶æ€
                        button.innerHTML = originalText;
                        button.disabled = false;

                        // æ˜¾ç¤ºé™çº§æç¤º
                        if (isTauri) {
                            showActionMessage('action-btn', '<i class="fas fa-download"></i> Tauriç¯å¢ƒå·²ä¸‹è½½', '#10b981');
                        } else {
                            showActionMessage('action-btn', '<i class="fas fa-download"></i> å·²ä¸‹è½½å›¾ç‰‡', '#10b981');
                        }
                    }
                }, 'image/png');

            } catch (error) {
                console.error('âŒ [æˆªå›¾] æˆªå›¾å¤±è´¥:', error);
                alert('æˆªå›¾å¤±è´¥ï¼š' + error.message);
                // æ¢å¤æŒ‰é’®çŠ¶æ€
                const button = event.target.closest('.action-btn');
                button.innerHTML = '<i class="fas fa-camera"></i><span>å¤åˆ¶è¡¨æ ¼æˆªå›¾</span>';
                button.disabled = false;
            }
        }

        // æ˜¾ç¤ºæ“ä½œæ¶ˆæ¯
        function showActionMessage(buttonClass, message, color) {
            const button = document.querySelector(`.${buttonClass}`);
            const originalContent = button.innerHTML;
            const originalBackground = button.style.background;

            button.innerHTML = message;
            button.style.background = `linear-gradient(135deg, ${color}, ${color}dd)`;

            setTimeout(() => {
                button.innerHTML = originalContent;
                button.style.background = originalBackground;
            }, 2000);
        }







        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initScheduleTable();
            initDragAndDrop();
            initContextMenu();
            initDaySelector();
            updateRandomButtonState();

            // æ·»åŠ ä¸€äº›æç¤ºä¿¡æ¯
            console.log('ğŸ‰ æ™ºèƒ½æ’ç­ç³»ç»Ÿå·²åŠ è½½å®Œæˆï¼');
            console.log('ğŸ“ ä½¿ç”¨è¯´æ˜ï¼š');
            console.log('   - æ‹–æ‹½æ ‡ç­¾åˆ°è¡¨æ ¼ä¸­è¿›è¡Œæ’ç­å®‰æ’');
            console.log('   - åŒå‡»å·²å®‰æ’çš„å•å…ƒæ ¼å¯ä»¥æ¸…ç©º');
            console.log('   - å³é”®ç‚¹å‡»å•å…ƒæ ¼å¯ä»¥æ‰“å¼€èœå•');
            console.log('   - é€‰æ‹©å¤©æ•°åç‚¹å‡»æ™ºèƒ½æ’ç­æŒ‰é’®è‡ªåŠ¨ç”Ÿæˆ');
            console.log('   - ä½¿ç”¨åº•éƒ¨æŒ‰é’®è¿›è¡Œæ¸…ç©ºã€å¯¼å‡ºã€ä¿å­˜æ“ä½œ');
            console.log('ğŸ’¡ æ–°åŠŸèƒ½ï¼š2å¤©äº’è¡¥æ’ç­ç®—æ³•ï¼Œç¡®ä¿å·¥ä½œè´Ÿè·å¹³è¡¡ï¼');

        });
        
        // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒï¼ˆå¯é€‰åŠŸèƒ½ï¼‰
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'z') {
                // å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ’¤é”€åŠŸèƒ½
                console.log('æ’¤é”€åŠŸèƒ½ï¼ˆå¾…å®ç°ï¼‰');
            }
        });
    </script>
</body>
</html>
